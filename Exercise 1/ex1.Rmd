---
title: "ASML EXAM Exercise 1"
output:
  pdf_document: default
  html_notebook: default
header-includes: \usepackage{bbm}
---

```{r warning=FALSE}
library(ggplot2)
library(tidyverse)
```


```{r}
dat = read.csv('data_ex1.csv')
dat
```

### <u>a) Make a drawing of those observations</u>

```{r}
ggplot(data = dat,aes(x=percent_agricultural_population,y=calories_per_day_per_person)) + 
  geom_point(shape=18,color="blue",size=2)+
  geom_text(aes(label=country),hjust=0, vjust=0)
```

### <u>b) Estimate the parameters of the model: Yi = β0 + β1.xi + εi</u>

```{r}
LM = lm(calories_per_day_per_person~percent_agricultural_population,data=dat)
LM$coefficients
```

- β0 = "(Intercept)" = 3346.12221
- β1 = "percent_agricultural_population" = -17.16353

### <u>c) Explain the different outputs of the lm funtions used in the R software and precise the tests that are performed and how they are performed.</u>

```{r}
summary(LM)
```

- Residuals:

  Difference between observed value and the one predicted by the model.
  We look for a symmetric distribution of the residuals around 0

- Coefficients:
  - Estimate: Estimation of β0 and β1 of our model.
  - Std. Error: is the standard deviation of the estimate
  - t value: Estimate / Std. error
  - Pr(>|t|): probability to observe value larger than t
  
    Student test performed for each parameter individually: H0 -> β1 = 0, H1 -> β1 != 0
    
    $$ P_{H0}\left ( \left | \widehat{\beta _{1}} \right |>t \right ) 
    with:
     \widehat{\beta _{1}} = \frac{\sum_{i=1}^{n}\left ( X_{i} - \bar{X_{n}} \right )(Y_{i} - \bar{Y_{n}})}{\sum_{i=1}^{n}\left ( X_{i} - \bar{X_{n}} \right )^{2}} $$

- Residual standard error:

  estimation of parameter σ for residuals with distribution N(0;σ)

- Multiple R-squared: 
  
  $$ R^{2} =\frac{\sum_{i=1}^{n}\left ( \widehat{Y_{i}}-\overline{Y_{n}} \right )^{2}}{\sum_{i=1}^{n}\left ( Y_{i}-\overline{Y_{n}} \right )^{2}} $$
  also called coefficient of determination = variance explained / total variance = 1 - (variance of residuals / variance total)
  
  gives information about goodness of fit of the model, should be close to one to be a correct linear model

- Adjusted R-squared:
  
  corrected version of R², taking unbiased estimator for the variances 

  $$ R_{adj}^{2}=1-\frac{n-1}{n-p-1}\left ( 1-R^{2} \right ) with: p\ nb\ of\ parameters\ in\ model $$

- F-statistic:
  it's a global Fisher Test with H0: β1=β2=...βp=0 , H1: at least one parameter is different from 0.
  
  observed value of F where $$F =\frac{\frac{\left \| \widehat{Y_{1}}-\overline{Y_{n}} \right \|^{2}}{Rk(X)-1}}{\frac{\left \| Y-\widehat{Y_{1}} \right \|^{2}}{n -Rk(X)}} $$
  
  - p-value:
  
    p-value associated with the test: $$ P(F(Rk(X)-1);n-Rk(X) > F_{obs}) $$
  
    if p-value > α : do not reject H0
  
    if p-value < α : we reject H0

### <u>d) Construt a confidence interval at 95% for the regression curve, at a point x0</u>


The Confidence interval for E[Y] at point x0 with confidence level 100(1-α)% is:

$$ \left [ \widehat{\beta _{0}}+\widehat{\beta _{1}}\pm \widehat{\sigma _{n}}\sqrt{\frac{1}{n}+\frac{(x_{0}-\overline{X_{n}})^{2}}{\sum (X_{i}-\overline{X_{n}})^{2}}} t_{1-\frac{\alpha }{2};n-2}\right ] $$


```{r}
pred = predict(LM, dat,interval="confidence")
pred
```


### <u>e) Draw the points, the regression curve and the curves associated to the confident interval on the same graphic.</u>

```{r}
dat2 = cbind(dat,pred)
ggplot(data=dat2 ) + 
  geom_point(aes(x=percent_agricultural_population, y=calories_per_day_per_person),shape=18,color="blue",size=2)+
  geom_text(aes(x=percent_agricultural_population, y=calories_per_day_per_person,label=country),hjust=0, vjust=0)+
  geom_line(aes(x=percent_agricultural_population, y=fit),col="red") + 
  geom_line(aes(x=percent_agricultural_population, y=lwr),linetype = "dashed",col="red") + 
  geom_line(aes(x=percent_agricultural_population, y=upr),linetype = "dashed",col="red")

```



